<!DOCTYPE html>
<html>
<header>
<title>Salary for different countries</title>
</header>
<head>
<meta charset="utf-8">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<link rel="stylesheet" href="nav.css" />

</head>
<style>

body {
  background-color: #dedede;
}

@keyframes heatmapAnimation {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.heatmap-rect {
  position: relative;
  animation: heatmapAnimation 1s ease forwards; /* 0.5s duration, ease timing, and forwards to keep the final state */
}

.heatmap-rect.show {
  opacity: 1;
  animation: none; /* Disable the animation when the heatmap is shown */
}


.tooltip {
  position: absolute;
  pointer-events: none;
  color: #231a1a;
  border-width: 3px;
}

.top {
  width: 100%;
  height: 620px;
}

.LH {
  width: 70%;
  height: 100%;
  float: left;
}

.RH {
  width: 30%;
  float: left;
  height: 100%;
}

#legend {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
}

.button-container {
    clear: both; /* This will ensure that the buttons start on a new line */
}

table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 80%;
  box-shadow: 0 0 50px rgba(0, 0, 0, 0.19);
}

td, th {
  border: 1px solid #111111;
  text-align: left;
  padding: 8px;
}

th {
  background-color: #155691;
  color: aliceblue;
}

tr:hover {
    background-color: #b1d3eb;
}

.filterButton {
  width: 150px;
  height: 50px;
  font-size: 15px;
  margin-bottom: 20px;
  text-align: center;
  text-decoration: none;
  cursor: pointer;
  border: 1px solid #155691;
  color: #293043;
  border-radius: 4px;
  background-color: #e4edf4; 
  transition: background-color 0.3s;
}

.filterButton:hover {
  background-color: #659EC7;
  color: #fff;
}

#C-name {
  width: 100%;
  height: auto;
  font-size: 2rem;
  font-weight: bold;
  margin-bottom: 10px;
  text-decoration: underline;
}

</style>
<body>
<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<div class="sidenav">
  <span class="navbtn" href=""><i class="fa fa-navicon"></i></span>

  <div class="items">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="choropleth_map.html">Unemployement</a></li>
        <li><a href="heatmap.html">Wages</a></li>
        <li><a href="sunburst.html">Population</a></li>
        <li><a href="pie_chart.html">Reason</a></li>
        <li><a href="#">Disease</a></li>
        <li><a href="bubble_chart.html">Immigration</a></li>
      </ul>
  </div>
</div>

<script>
const btn = document.querySelector(".navbtn");
  btn.addEventListener("click",()=>{
  document.body.classList.toggle("active")
  })
</script>

<div class="details">

</div>

<div class="H-chart">
  <div class="top">
  <div class="LH">
    <div id="my_dataviz"></div>
  </div>

  <div class="RH">
    <div id="legend"></div>
  </div>
</div>

<div class="button-container">
  <button class="filterButton" data-country="Myanmar">Myanmar</button>
  <button class="filterButton" data-country="India">India</button>
  <button class="filterButton" data-country="Cyprus">Cyprus</button>
  <button class="filterButton" data-country="Belgium">Belgium</button>
  <button class="filterButton" data-country="Austria">Austria</button>
  <button class="filterButton" data-country="Italy">Italy</button>
  <button class="filterButton" data-country="Germany">Germany</button>
  <button class="filterButton" data-country="All">All</button>

  <div id="C-name"></div>
  <div id="table_Country"></div>
</div>
</div>


<script>

  // set the dimensions and margins of the graph
  var margin = {top: 50, right: 100, bottom: 50, left: 50},
    width = 1000 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;
  
  // append the svg object to the body of the page
  var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");
  
  d3.selectAll(".heatmap-rect")
  .classed("heatmap-transition", true);

/**************************************/

  // Build X scales and axis:
  var x = d3.scaleBand()
    .range([ 0, width ])
    .padding(0.03);
  
  // Build X scales and axis:
  var y = d3.scaleBand()
    .range([ height, 0 ])
    .padding(0.03);
  
/**************************************/

  // Build color scale
  /*
  var myColor = d3.scaleLog()
    .range(["#1B4F72", "#28B463"])
    .domain([1,1000])
  */

  //Read the data
  d3.csv("salary.csv", function(data) {

/***************************************/
  
  // Ascending the year 

  // Sort the data in descending order by year
  data.sort(function(a, b) {
    return d3.ascending(+a.year, +b.year);
  });

  // Calculate the minimum and maximum monthly_wages values
  var minWages = d3.min(data, function(d) { return +d.monthly_wages; });
  var maxWages = d3.max(data, function(d) { return +d.monthly_wages; });

/***************************************/

var myColor = d3.scaleLinear()
  .range(["#EBF4FA", "#D0EFFF"])
  .domain([minWages, 10.000]);

var myColor2 = d3.scaleLinear()
  .range(["#BDEDFF", "#ADDFFF"])
  .domain([10.001, 20.000]);

var myColor3 = d3.scaleLinear()
  .range(["#B0E0E6", "#89CFF0"])
  .domain([20.001, 50.000]);

var myColor4 = d3.scaleLinear()
  .range(["#659EC7", "#368BC1"])
  .domain([50.001, 700.000]);

var myColor5 = d3.scaleLinear()
  .range(["#4682B4", "#3090C7"])
  .domain([700.001, 800.000]);

var myColor6 = d3.scaleLinear()
  .range(["#368BC1", "#2554C7"])
  .domain([800.001, 1000.000]);

var myColor7 = d3.scaleLinear()
  .range(["#2554C7", "#1D4DAB"])
  .domain([1000.001, 1200.000]);

var myColor8 = d3.scaleLinear()
  .range(["#155691", "#0D4F76"])
  .domain([1200.001, 1400.000]);
  
var myColor9 = d3.scaleLinear()
  .range(["#05475C", "#003E42"])
  .domain([1400.001, 1700.000]);

var myColor10 = d3.scaleLinear()
  .range(["#003429", "#040720"])
  .domain([1700.001, maxWages]);


  var Color = function(d) {
  if (d >= minWages && d <= 10.000) {
    return myColor(d);
  } else if (d > 10.000 && d <= 20.000) {
    return myColor2(d);
  } else if (d > 20.000 && d <= 50.000) {
    return myColor3(d);
  } else if (d > 50.000 && d <= 700.000) {
    return myColor4(d);
  } else if (d > 700.000 && d <= 800.000) {
    return myColor5(d);
  } else if (d > 800.000 && d <= 1000.000) {
    return myColor6(d);
  } else if (d > 1000.000 && d <= 1200.000) {
    return myColor7(d);
  } else if (d > 1200.000 && d <= 1400.000) {
    return myColor8(d);
  } else if (d > 1400.000 && d <= 1700.000) {
    return myColor9(d);
  } else if (d > 1700.000 && d <= maxWages) {
    return myColor10(d);
  } 

};



  /****************************************/

  x.domain(data.map(function(d) { return d.country_name; }));
  y.domain(data.map(function(d) { return d.year; }));

  // create a tooltip
  var tooltip = d3.select("#my_dataviz")
    .append("div")
      .style("opacity", 0)
      .attr("class", "tooltip")
      .style("background-color", "#F5F5F5")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "5px")
      .style("padding", "5px");

  // Three function that change the tooltip when user hover / move / leave a cell
  var mouseover = function(d) {
    tooltip
      .style("opacity", 1)
    d3.select(this)
      .style("stroke", "black")
      .style("opacity", 1)
  }

  var mousemove = function(d) {
    tooltip
      .html("<b><h3>" + d.country_name + 
      "</h3></b><br> Country code: " + d.country_code + "<br>Year: " + d.year + 
      "<br>Monthly wages: " + d.monthly_wages + "<br>Hour wages: " + d.hour_wages)
      .style("left", (d3.mouse(this)[0]+70) + "px")
      .style("top", (d3.mouse(this)[1]) + "px");
  }
  var mouseleave = function(d) {
    tooltip
      .style("opacity", 0)
    d3.select(this)
      .style("stroke", "none")
      .style("opacity", 0.8)
  }

  var activeBox = null; // Initialize active state variable

  // Add a class to show heatmap rectangles with fade-in animation
  d3.selectAll(".heatmap-rect").classed("show", true);

  
    // add the squares
  svg.selectAll()
    .data(data)
    .enter()
    .append("rect")
    .attr("id", "heatmap-rect") 
    .attr("x", function(d) { return x(d.country_name) })
    .attr("y", function(d) { return y(d.year) })
    .attr("width", x.bandwidth() )
    .attr("height", y.bandwidth() )
    .style("fill", function(d) { return Color(d.monthly_wages);} )
    .style("stroke-width", 4)
    .style("stroke", "none")
    .on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave);


  // Add X axis
  svg.append("g")
    .attr("transform", "translate(0," + height + ")")
    .call(d3.axisBottom(x))
    .attr("font-size", "15px");

    // Add Y axis
  svg.append("g")
    .call(d3.axisLeft(y))
    .attr("font-size", "15px");

/**********************************************************/

// filter button
d3.selectAll(".filterButton").on("click", function() {
  var selectedCountry = d3.select(this).attr("data-country");
  
  if (selectedCountry === "All") {
    // Reset the country name div
    d3.select("#C-name").text('');

    // Clear the table
    d3.select("#monthlyWagesTable").remove();

    // Reload the table with all data
    displayMonthlyWagesTable(data);
  } else {
    // Filter data based on selectedCountry
    var filteredData = data.filter(function(d) {
      return d.country_name === selectedCountry;
    });

  d3.select("#C-name")
    .text(selectedCountry);

  // Update the heatmap with the filtered data
  updateHeatmap(filteredData);

  // Display monthly wages in a table
  displayMonthlyWagesTable(filteredData);
  }
});


function displayAllSquares() {
  // Clear existing rectangles
  svg.selectAll("rect").remove();

  // Add the squares for all data
  svg.selectAll()
    .data(data)  // Use the original data
    .enter()
    .append("rect")
    .attr("class", "heatmap-rect") 
    .attr("x", function(d) { return x(d.country_name) })
    .attr("y", function(d) { return y(d.year) })
    .attr("width", x.bandwidth() )
    .attr("height", y.bandwidth() )
    .style("fill", function(d) { return Color(d.monthly_wages);} )
    .style("stroke-width", 4)
    .style("stroke", "none")
    .on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave);
}

function updateHeatmap(filteredData) {
  // Clear existing rectangles
  svg.selectAll("rect").remove();

  d3.selectAll(".filterButton").on("click", function() {
  var selectedCountry = d3.select(this).attr("data-country");

  if (selectedCountry === "All") {
    // Reset the country name div
    d3.select("#C-name").text('All Country');

    // Clear the table
    d3.select("#monthlyWagesTable").remove();

    // Call the function to display all squares
    displayAllSquares();

    displayMonthlyWagesTable(data);
  } else {

    // Filter data based on selectedCountry
    var filteredData = data.filter(function(d) {
      return d.country_name === selectedCountry;
    });

    d3.select("#C-name")
      .text(selectedCountry);

    // Clear existing rectangles
    svg.selectAll("rect").remove();

    // Add the squares for filtered data
    svg.selectAll()
      .data(filteredData)
      .enter()
      .append("rect")
      .attr("class", "heatmap-rect") 
      .attr("x", function(d) { return x(d.country_name) })
      .attr("y", function(d) { return y(d.year) })
      .attr("width", x.bandwidth() )
      .attr("height", y.bandwidth() )
      .style("fill", function(d) { return Color(d.monthly_wages);} )
      .style("stroke-width", 4)
      .style("stroke", "none")
      .on("mouseover", mouseover)
      .on("mousemove", mousemove)
      .on("mouseleave", mouseleave);
      
    // Display monthly wages in a table
    displayMonthlyWagesTable(filteredData);
  }

});
}

function displayMonthlyWagesTable(filteredData) {
  // Clear existing table
  d3.select("#monthlyWagesTable").remove();

  // Create a new table
  var table = d3.select("#table_Country")
    .append("table")
    .attr("id", "monthlyWagesTable");
  
  // Create table headers
  var headers = table.append("thead").append("tr");
  headers.selectAll("th")
    .data(["Counrty Name", "Year", "Monthly Wages"])
    .enter().append("th")
    .text(function(d) { return d; });
  
  // Create table rows
  var rows = table.append("tbody")
    .selectAll("tr")
    .data(filteredData)
    .enter().append("tr");
  
  // Populate table cells
  rows.selectAll("td")
    .data(function(d) { return [d.country_name, d.year, d.monthly_wages]; })
    .enter().append("td")
    .text(function(d) { return d; });
}


/**********************************************************/  
  
  // color legend 
  var legendData = [
  { label: '0 - 10.000', color: myColor(minWages) },
  { label: '10.001 - 20.000', color: myColor2(10.001) },
  { label: '20.001 - 50.000', color: myColor3(20.001) },
  { label: '50.001 - 700.000', color: myColor4(50.001) },
  { label: '700.001 - 800.000', color: myColor5(700.001) },
  { label: '800.001 - 1000.000', color: myColor6(800.001) },
  { label: '1000.001 - 1200.000', color: myColor7(1000.001) },
  { label: '1200.001 - 14000.000', color: myColor8(1200.001) },
  { label: '1400.001 - 1700.000', color: myColor9(1400.001) },
  { label: '1700.001 - 2000.000', color: myColor10(1700.001) },
  // Add more legend data as needed
];

var legendSvg = d3.select("#legend")
  .append("svg")
  .attr("class", "legend")
  .attr("width", 200)
  .attr("height", 200);

var legend = legendSvg.selectAll('.legend')
  .data(legendData)
  .enter()
  .append('g')
  .attr('class', 'legend')
  .attr('transform', function(d, i) {
    return 'translate(0,' + (i * 20) + ')';
  });

legend.append('rect')
  .attr('width', 30)
  .attr('height', 30)
  .style('fill', function(d) { return d.color; });

legend.append('text')
  .attr('x', 40)
  .attr('y', 10)
  .attr('dy', '.35em')
  .text(function(d) { return d.label; });

});
  
  </script>
</body>
</html>