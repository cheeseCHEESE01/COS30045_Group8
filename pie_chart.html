<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pie Chart</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="nav.css" />
  <script src="http://d3js.org/d3.v3.min.js"></script>

</head>

<style>
  body {
    font: 10px sans-serif;
  }

  .arc path {
    stroke: #fff;
    cursor: pointer;
  }

  .tooltip {
    position: absolute;
    text-align: center;
    background: #000000cc;
    color: #fff;
    border-radius: 5px;
    padding: 5px;
    font-size: 12px;
    opacity: 0;
    line-height: 200%;
  }

  .all {
    width: 100%;
    height: 700px;
}

.left {
    margin: auto;
    width: 70%;
    height: 100%;
    float: left;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #4f9696;
}

.right {
    width: 30%;
    height: 100%;
    float: left;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #b88139;
}


#chart {
    max-width: 800px;
    margin: 0 auto;
}

.info {
    color: black;
}

.legend {
    margin-bottom: 20px;
}

.legend strong {
    font-size: 18px;
    text-decoration: underline; 
}
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>

<div class="sidenav">
  <span class="navbtn" href=""><i class="fa fa-navicon"></i></span>

  <div class="items">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="choropleth_map.html">Unemployement</a></li>
        <li><a href="heatmap.html">Wages</a></li>
        <li><a href="sunburst.html">Population</a></li>
        <li><a href="pie_chart.html">Reason</a></li>
        <li><a href="clustered_stacked_bar_chart.html">Disease</a></li>
        <li><a href="bubble_chart.html">Immigration</a></li>
      </ul>
  </div>
</div>

<script>
const btn = document.querySelector(".navbtn");
  btn.addEventListener("click",()=>{
  document.body.classList.toggle("active")
  })
</script>


<div class="all">
  <div class="left">
      <div id="chart"></div>

      <div id="tooltip" class="tooltip"></div>
      </div>

  <div class="right">
    
  </div>
  </div>

<script>

var width = 1000,
    height = 650,
    radius = Math.min(width, height) / 2;

var color = d3.scale.ordinal()
    .range(["#E6B0AA", "#AF7AC5", "#5DADE2", "#48C9B0", "#ABEBC6", "#F7DC6F", "#DC7633", "#979A9A", "#5D6D7E", "#4A235A", "#2874A6", "#CD4639", "#FFA7F7", "#D2E559"]);

// 修改内外半径以创建环形图
var arc = d3.svg.arc()
    .outerRadius(radius - 250)
    .innerRadius(radius - 10); // 调整内半径以创建环

var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.male; });

var svg = d3.select("#chart").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var tooltip = d3.select("#tooltip")
    .style("opacity", 0);

d3.csv("migration_reason.csv", function(error, data) {
  data.forEach(function(d) {
    d.male = +d.male;
  });

  var g = svg.selectAll(".arc")
      .data(pie(data))
    .enter().append("g")
      .attr("class", "arc")
      .on("mouseover", function(d) {
        tooltip.transition()
          .duration(200)
          .style("opacity", .9);
        tooltip.html("Reason For Migration: " + d.data.reason_for_migration + "<br/>" + "Male: " + d.data.male)
          .style("left", (d3.event.pageX +20) + "px")
          .style("top", (d3.event.pageY - 28) + "px")
      })
      .on("mouseout", function(d) {
        tooltip.transition()
          .duration(500)
          .style("opacity", 0);
      });

  g.append("path")
      .attr("d", arc)
      .style("fill", function(d) { return color(d.data.reason_for_migration); });
});

</script>
</body>
</html>
